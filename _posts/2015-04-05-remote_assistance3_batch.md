---
layout: post
title: 実家のWindows PCをネット越しに世話する(3) ～ バッチファイルで楽をする
excerpt_separator: <!--more-->
tags:
- Windows
- Remote Assistance
---

このエントリーは、これまでに書いてきた下記2つのエントリーの続きになります。

  {% include rmas_links.md %}

- [実家のWindows PCをネット越しに世話する(1) ～ リモート アシスタンスのおさらい]
[rmas1]
- [実家のWindows PCをネット越しに世話する(2) ～ 実家と共有できるフォルダを用意する][rmas2]

今回は、実家PCとリモートアシスタンス接続をより簡単にするための二つめの仕掛け「バッチファイル」について説明してみます。
<!--more-->

# 「バッチファイル」を導入する効果

バッチファイルとはどういうものか？を説明する前に、バッチファイルを使うことによる効果を見ていただきましょう。

下の図は、[第1回][rmas1]のエントリーで説明した3つのStepのうち、Step.1とStep.2の内容をそのまま切り出してきたものです。<br>
あまりに縦に長くなるので、途中2カ所で切って、三列に並べてみました。

[![バッチファイルの効果][3]][3]

  [3]: /images/rmas/effect_of_batch.png

図の凡例にも書いてあるように、「バッチファイル」を導入し、以下の手順を踏むことによって、水色の網掛け部分の作業が不要になります。

1. あなたが（これから説明する方法で）用意したバッチファイルを、何らかの手段で実家PCに届ける
2. 実家の家族に、その**バッチファイルをダブルクリック**してもらう。

以上です。<br>
かなり楽になる気がしませんか？

バッチファイルと実家PCに届けるには、メールに添付してもいいし、[第2回][rmas2]で説明したような共有フォルダを使って届けても構いません。<br>
ファイルが実家に届きさえすれば、何だってアリです。

ちなみに、上図で唯一残されていた「Step.2の前半部」についても、[一つめの仕掛けである共有フォルダ][rmas2]を用意できていたら、不要になります。

「二つの仕掛けの合わせ技」による効果は、次回のエントリーで説明する予定です。

# あらためて、バッチファイルとは？

ざっくり言うと、*実行可能なテキストファイル*のことです。<br>
（正しい説明は[Micorsoftのページ](https://msdn.microsoft.com/ja-jp/library/cc758944(v=ws.10).aspx)でどうぞ。）

「メモ帳」でいいので、「コマンド」なるものを並べたテキストファイルを作って、そのファイルを`.bat`や`.cmd`といった拡張子を付けて保存すれば出来上がり。<br>
そのファイルをダブルクリックしたら、中に並べた「コマンド」が順に実行されることになっています。

#### 「リモート アシスタンス接続」とバッチファイルの関係は？

[第1回][rmas1]のStep.1で説明したように、あるいは上図で示したように、リモートアシスタンスを起動するところから招待ファイルを作成して保存するまでには、実家の家族にたくさんの画面（GUI）を操作してもらう必要がありました。

しかし、これらの操作は、バッチファイルの中に書いておく一個の「コマンド」`Msra.exe`で全て代替できます！

このコマンドを使うためのバッチファイルの書き方は、後で説明します。<br>
もしこのコマンドの詳細を知りたくなったら、[Microsoftの説明](https://technet.microsoft.com/ja-jp/windows/ff467970.aspx)を参照してみてください。（読まなくても全く問題ありません。）

#### まだあるバッチファイルのメリット

バッチファイルを使うと、さらに良いことがあります。

[第1回][rmas1]のStep.2で、「招待ファイルだけでなく、実家PCの画面に表示される12文字のパスワードをあなたが受け取る必要がある」と説明しましたが、この作業もバッチファイルを使うことで不要になります。

なぜかというと、バッチファイルの中に、コマンド`Msra.exe`と一緒に*あなたが勝手に決めたパスワード*を書いておけるから、です。*あなたが後で必要とするパスワードは、あなたが実家に送るバッチファイルに前もって埋め込んでおける*、という訳です。

これによって、Step.2の後半の作業も代替できてしまいます。

# バッチファイルを作ってみる

前置きが長くなりましたが、「招待ファイルを作る」ためのバッチファイルを作ってみましょう。

メモ帳、またはお好きなテキストエディタを開いて、次の一行を入力します。<br>
そのままコピペでOKです。

{% highlight sh %}
msra.exe /saveasfile %USERPROFILE%\Documents\招待.msrcIncident test00
{% endhighlight %}

- 注1) 折り返して二行に見えるかもしれませんが、実際には一行です。
- 注2) 途中の`\`記号は、Windowsでは￥記号と同じです。コピペすると、勝手に￥記号になってくれます。

このファイルを保存するときに、少し注意が必要です。

#### 拡張子を`.bat`にするための注意点

保存するフォルダやファイル名はは適当に決めていいのですが、ファイル名の拡張子だけは`.bat`を指定する必要があります。<br>
しかし、メモ帳の場合、「どうしても拡張子が`.txt`になってしまう」ということが起きがちです。

拡張子を`.txt`ではないもの変えたい場合には、ファイル保存の画面で「ファイルの種類」から「すべてのファイル (＊.＊)」を選択します。

[![拡張子にtxt以外をしていするために][4]][4]

  [4]: /images/rmas/care_about_ext.png

これで、`<お好きな名前>.bat`という名前で保存できるはずです。<br>
次の図は、`招待ファイルを作る.bat`という名前で保存する例です。

[![バッチファイルを保存][5]][5]

  [5]: /images/rmas/save_bat_file.png

以上で、バッチファイルができました。<br>
エクスプローラーで確認してみましょう。特にフォルダを指定していなければ、「ドキュメント ライブラリ」あたりにできているのではないでしょうか？

[![バッチファイルができたことを確認][6]][6]

  [6]: /images/rmas/check_bat_in_explorer.png

# バッチファイルを実行してみる

作ったばかりのバッチファイルをダブルクリックして、試しに実行してみましょう。<br>
あなたが実家PCにバッチファイルを送った後、実家の家族がそれを実行したときに何が起きるのか？が分かると思います。

二つのことが起きるはずです。

#### 実行結果(1) リモートアシスタンスの画面が開く

黒地の画面が現れたと思ったら、それに被さるように「Windowsリモート アシスタンス」画面がすぐに開きます。

[![バッチファイルができたことを確認][7]][7]

  [7]: /images/rmas/rmas_opened.png

なお、先ほど作ったバッチファイルの中身を再掲しますと、

{% highlight sh %}
msra.exe /saveasfile %USERPROFILE%\Documents\招待.msrcIncident test00
{% endhighlight %}

というものでしたが、この末尾の`test00`に注目してください。これは、そのままリモートアシスタンス画面のパスワード欄に表示されていますよね。<br>
このバッチファイルの末尾を書き換えることで、好きなようにパスワードを設定することができます。（セキュリティのため、どんどん変えていきましょう）


#### 実行結果(2) 招待ファイルが作られる

エクスプローラーで、「ドキュメント ライブラリ」フォルダを開いてみてください。<br>
そこに`招待.msrcIncident`というファイルができているはずです。

[![招待ファイルができた][8]][8]

  [8]: /images/rmas/invitation_file_created.png

「このフォルダにこの名前で招待ファイルを作る」ということも、パスワードと同様に、バッチファイルの中で指定したことなのです。

しつこいようですが、バッチファイルの中身を再掲します。

{% highlight sh %}
msra.exe /saveasfile %USERPROFILE%\Documents\招待.msrcIncident test00
{% endhighlight %}

この真ん中あたり、`%USERPROFILE`から`招待.msrcIncident`までの文字列で、招待ファイルの作成場所と名前を指定しているのです。

ですから、ここを書き換えれば、違うフォルダに別の名前で招待ファイルを作っちゃうことも可能です。<br>
（実際、[次回][rmas4]の「二つの仕掛けの合わせ技事例」ではここを書き換えます。）

ただし！*拡張子`.msrcIncident`だけは変えないでおきましょう！*<br>
これを変えてしまうと、招待ファイルとして機能しなくなるので要注意です。

#### 上書き確認ダイアログが出ても慌てない

なお、同じ内容のバッチファイルを複数回実行すると、2回目からは次のような確認ダイアログがでるかもしれません。

![招待ファイルの上書き確認][9]

  [9]: /images/rmas/confirm_overwrite.png

何を置き換えるのか、このダイアログだとよく分かりませんが、<br>
*招待ファイルを作ろうしていているフォルダに、既に同名の招待ファイルがありますが、上書きしてもいいですか？*<br>
ということを聞いているだけです。

ここは「はい」を押せばOK。それによって招待ファイルが更新されます。

#### バッチファイルを実行したことで、結局何ができたか？

1. バッチファイル内で指定したフォルダ内に、指定した名前の招待ファイルを作ることができた。（←[第1回][rmas1]のStep.1に相当）
2. リモートアシスタンス接続を確立するときに必要になるパスワードを、あらかじめバッチファイルに埋め込んでおけた。（←[第1回][rmas1]のStep.2後半に相当）

# 今回のエントリー（第3回）のまとめ

今回のエントリーでは、次のことを説明してみました。

- バッチファイルを使えば、[第1回][rmas1]で紹介した作業のかなりの部分を省けること
- バッチファイルの具体的な作り方
- バッチファイルを試しに実行 → いずれ実家PCで起きることの一部を体験

[次回][rmas4]のエントリーでは、二つの仕掛け「共有フォルダ」と「バッチファイル」を組み合わせると、リモートアシスタンス接続はどれくらい楽に確立できるのか？について紹介したいと思います。

続き（次回）はこちら↓から。
<div class="sharelink" style="padding: 6px; border: 1px solid #aaaaaa;  margin: 0px 0px 50px;"><a href="http://blog.sato0123.com/2015/04/12/remote_assistance4_best_practice/" title="実家のWindows PCをネット越しに世話する(4) ～ 共有フォルダとバッチの組合せ事例 · Yoshi's Notes" target="_blank"><img src="http://capture.heartrails.com/120x90/shadow?http://blog.sato0123.com/2015/04/12/remote_assistance4_best_practice/" width="120" height="90" style="float: left;"></a><a href="http://blog.sato0123.com/2015/04/12/remote_assistance4_best_practice/" title="実家のWindows PCをネット越しに世話する(4) ～ 共有フォルダとバッチの組合せ事例 · Yoshi's Notes" target="_blank">実家のWindows PCをネット越しに世話する(4) ～ 共有フォルダとバッチの組合せ事例 · Yoshi's Notes</a><a href="http://b.hatena.ne.jp/entry/http://blog.sato0123.com/2015/04/12/remote_assistance4_best_practice/"><img src="http://b.hatena.ne.jp/entry/image/http://blog.sato0123.com/2015/04/12/remote_assistance4_best_practice/" alt="はてなブックマーク - 実家のWindows PCをネット越しに世話する(4) ～ 共有フォルダとバッチの組合せ事例 · Yoshi's Notes" title="はてなブックマーク - 実家のWindows PCをネット越しに世話する(4) ～ 共有フォルダとバッチの組合せ事例 · Yoshi's Notes"></a><br style="clear: both;" /></div>